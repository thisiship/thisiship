<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Website for viewing local music events">
    <meta name="author" content="source - http://github.com/tonisbones">
	<title> This Is Hip </title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <script src="js/vendor/jquery.min.js"></script>

    <link href="css/thisiship.css" rel="stylesheet">
</head>
<body>
	<div class="container">
		<nav class="navbar navbar-toggleable-md navbar-light">
			<div class="container">
				<a class="navbar-brand" href="index.html">This Is Hip</a>
			</div>
		</nav>
	</div>
	<div class="container">
		<div class="panel">	
			<div class="panel-heading">
				<h3 id="event_name" class="panel-title">Cannot Find Event</h3>
			</div>
			<div class="panel-body">
				<p id="event_start"></p>
				<p id="event_end"></p>
				<p><a href="" id="facebook_url"></a></p>
				<p id="event_desc">It looks like you haven't specified an event to view or your event cannot be found.</p>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		$(document).ready(function() {
			var url_beginning = "https://tonisbones.github.io/facebookeventjsondump/events/";
			var url_extension = ".json";
			function getSearchParameters() {
				var prmstr = window.location.search.substr(1);
				return prmstr != null && prmstr != "" ? transformToAssocArray(prmstr) : {};
			}

			function transformToAssocArray( prmstr ) {
				var params = {};
				var prmarr = prmstr.split("&");
				for ( var i = 0; i < prmarr.length; i++) {
					var tmparr = prmarr[i].split("=");
					params[tmparr[0]] = tmparr[1];
				}
				return params;
			}

			var params = getSearchParameters();
			var event_id = params.event_id;
			if (event_id != null) {
				var url_for_json = url_beginning + event_id + url_extension;
				$.getJSON( url_for_json, function(data) {
					$("#event_name").text("Event Name: " + data.name);
					$("#event_desc").text("Event Description: " + data.description);
					var start_date = new Date(data.start_time)
					console.log(start_date);
					if (data.start_time !== undefined)
						$("#event_start").text("Event Start: " + start_date);
					var end_date = new Date(data.end_time)
					console.log(end_date);
					if (data.end_time !== undefined)
						$("#event_end").text("Event End: " + end_date);
					var facebook_url = "http://www.facebook.com/events/" + event_id;
					$("#facebook_url").text("Facebook Event").attr("href", facebook_url);
				})
				.fail(function () {
					console.log("Failed to find event: " + event_id);
					$("#event_name").text("Failed to find event: " + event_id);
				});
			}
		});
	</script>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script>window.jQuery || document.write('<script src="js/vendor/jquery.min.js"><\/script>')</script>
    <script src="js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>
</body>
